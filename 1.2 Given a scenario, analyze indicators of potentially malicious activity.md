## 1.2 Given a scenario, analyze indicators of potentially malicious activity
---
### 1.2.1
**Network-related**:
**Bandwidth consumption**- may be part of a DOS attack. 
**Beaconing**- When a command and control server starts talking to infected bots. Most usually a simple ping to see if the bot is still alive. 
The C&C network frequently change DNS names and IP addresses -> harder to track down. 
Its usually the packet's metadata that contain info about the C&C's beaconing information 
Channels C&C server can communicate over: 
- Internet Relay Chat (IRC) - Communication protocol; used much in the past not much now 
- HTTP and HTTPS- Web access is needed in most orgs so this is targeted by attackers by adding encrypted commands. SSL inspection to detect this. 
- Domain Name System (DNS)- Bot talks to DNS server for commands, no outside internet access. Embedded into request or response queries, this makes it longer making it easier to detect 
- Social media- C&C issues commands over the platform's messaging capability, Platforms incorporate controls to limit abuse
- Media and document files- Commands in metadata, and send media file to bots over any communication channels supporting media sharing. Most monitoring systems do not review metadata. 
**Irregular peer-to-peer communication**- Usually in a network peers only talk to servers, peer to peer traffic is usually unusual. P2P traffic in the network could indicate that a bot is communicating with a centralized C&C server. 
**Rogue devices on the network**- Any piece of hardware/software that allows rouge access to a network. 
Rouge Access point - the copy of someones WiFi but this ones malicious. 

| Rogue Device Type            | Description                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Network taps                 | A physical device might be attached to cabling to record packets passing over that segment. Once attached, taps cannot usually be detected from other devices inline with the network, so physical inspection of the cabled infrastructure is necessary.                                                                                                                                                                        |
| Wireless access points (WAP) | While there are dedicated pen test rogue WAPs, such as the Wi-Fi Pineapple ( [shop.hak5.org/products/wifi-pineapple](https://shop.hak5.org/products/wifi-pineapple) ), anyone with access to the network can create a WAP, even from a non-specialized device like a laptop or smartphone. The WAP can be used to intentionally mislead others into connecting to the rogue access point, opening the door for on-path attacks. |
| Servers                      | An attacker may also use a server as a malicious honeypot to harvest credentials and data. This type of attack often requires some method of traffic diversion, usually either through ARP poisoning or corrupted name resolution.                                                                                                                                                                                              |
| Wired and wireless clients   | End-user devices may introduce malware, perform network reconnaissance, or enable data exfiltration. Most user devices also include cameras and microphones.                                                                                                                                                                                                                                                                    |
| Software                     | Rogue servers and applications, such as malicious DHCP or DNS servers, may be installed covertly on authorized hardware.                                                                                                                                                                                                                                                                                                        |
| Virtual machines             | Virtual machines make deploying rogue servers much simpler, as virtualization software is available for many different operating systems and device types.                                                                                                                                                                                                                                                                      |
| Smart appliances             | Devices such as printers, webcams, and VoIP handsets often contain exploitable vulnerabilities in their firmware. These devices can be used as a vector for attack. Smart appliances, including TVs, refrigerators, and "streaming sticks," are often installed in facilities with little oversight or restriction.                                                                                                             |


| Detection Technique                 | Description                                                                                                                                                                                             |
| ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Visual inspection of ports/switches | Simply looking for out-of-place devices or odd cabling connections is very effective. Looking inside cabinets and under desks for tape-mounted Raspberry Pi and other microcomputers is very important. |
| Network mapping/host discovery      | Network scans can identify hosts and use banner grabbing and fingerprinting to collect valuable information. DHCP logs are also very helpful.                                                           |
| Wireless monitoring                 | Discover unknown or unidentifiable service set identifiers (SSIDs) showing up within range of the office.                                                                                               |
| Packet sniffing and traffic flow    | Reveal the use of unauthorized protocols on a network and suspicious peer-to-peer communication.                                                                                                        |
| NAC and intrusion detection         | Security suites and appliances can combine automated network scanning with defense and remediation suites to prevent rogue devices from accessing the network.                                          |
**Scans/sweep**- initial stages of an attack often include network scans and ping sweeps to identify hosts and services on the network, to gather info and see which ones to attack, Enumeration. 
Scans originating from unauthorized locations and devices should be immediately investigated. Intrusion detection systems can detect most types of scanning activity, though there are some methods of evading detection, such as sparse scanning.
**Unusual traffic spikes**- spikes usual times, coming from different areas, etc
**Activity on unexpected ports**- standardization of ports by IANA, so activity on the non-standardized ports may be more suspicious. review which applications need these ports open.   
### 1.2.2
**Host-related**
**Processor consumption**- Process analysis- Use Task manager/Tasklist,Taskkill in Windows, Top in linux,     Shift+P to sort by CPU usage, Shift+M to sort by memory usage, Shift+T to sort by execution time, Shift+N to sort by PID
**Memory consumption**- Use Free command in Linux to analyze memory util, Use a Memory Dump to further analyze memory content. FTK Imager (Windows), Linux Memory Grabber (Linux)
**Drive capacity consumption**- one location to stage data for exfiltration, 
Staging areas- - Temp files, User profile folders,  Log files, Recycle Bin
Metadata- Windows `dir` used to view certain file attributes, Linux `lsof` does the same 
NTFS Alternate Data Streams (ADS)- allows a file to contain more than one stream of data. malware in the stream of data. 
High disk usage- `df` and `du`
Data encryption- Rasomware, see if the decryption key is obtainable. 
**Unauthorized software**- can create vulns, access to malware, bypass security. Any Software not approved by IT like certain Remote access tools (RATs). 
**Malicious processes**- look at services or processes and kill them using `ps -*args*` or winservices, recognize core OS processes, look at properties 
**Unauthorized changes**- to gain privileges:
    Failed logins
    Unauthorized sessions
    New accounts
    After-hours access
    Guest account access
Opening new network ports so malware can communicate outside the network. use an open network port to maintain remote access to the system.
Installing new programs on the system.
**Unauthorized privileges**- Privilege Escalation

| Escalation Type                 | Description                                                                                                                                                                                                |
| ------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Horizontal privilege escalation | An application lets an attacker gain access to resources that would normally be protected by an application or user privilege.                                                                             |
| Vertical privilege escalation   | An attacker or an application with lower privileges accesses functions or content reserved for higher privilege users or applications. Vertical privilege escalation is also known as privilege elevation. |
Prevention-Use strong passwords, Limit user privileges, Check for system vulnerabilities on a regular basis.
IoCs- Unauthorized sessions, Failed logons for admin accounts, New accounts, Guest account usage, Off-hours usage
**Data exfiltration**- host staging areas, data transfers outside normal hours, Sensitive files being compressed or encrypted. Use DLP solutions, look at outbound traffic, look for TOR, FTP, SCP, Dropbox, Google Drive upload logs
**Abnormal OS process behavior**- Legitimate processes behaving abnormally (svchost.exe making network connections), High CPU/memory usage by background services, Child processes launched by unexpected parents (Word launching PowerShell). 
Utilize Sysmon, EDR, Windows Event Logs, detections in SIEMs. 
**File system changes or anomalies**- Look at **Drive capacity consumption**
**Registry changes or anomalies**- Persistence mechanisms added: `HKLM\Software\Microsoft\Windows\CurrentVersion\Run`, Disabling Windows Defender or UAC via registry and Changes to file associations or shell entries. 
Registry Auditing, Logging/Change Alerts.  
**Unauthorized scheduled tasks**- What to Look For: New or modified scheduled tasks running scripts/tools, Task names that look benign (e.g., "System Update", "Chrome Sync") and Tasks executing from unusual locations (e.g., C:\Users\Public\temp.bat)
Look at: Audit logs: Event ID 4698 (task created), 4702 (task updated), 4699 (task deleted), Task Scheduler view (`schtasks /query`), EDR alerts for persistence mechanisms
### 1.2.3
**Application-related**:
**Anomalous activity**- User and Entity Behavior (UEBA)- a solution to scan indicators from multiple intrusion detection and log sources to identify anomalies. integration with SIEMs 
**Introduction of new accounts**- especially admin/ higher privileged accounts. 
user account abnormal activity:
- Incorrect permissions or ownership
- Anonymous logins
- Unusual account names
- Changes to group membership
- New unknown accounts or suspicious local accounts
- Activity or logins during non-standard hours
- Nonadministrative account logged into a server
**Unexpected output**- Prompts for windows UAC/ other popups randomly
**Unexpected outbound communication**- analyze outbound connections frequently for suspicious behavior, Beaconing, Malware, Data exfiltration.  
**Service interruption**- 
- Applications/services unexpectedly crashing or stopping
- Repeated service restarts or hung states
- Denial of service (DoS)-like symptoms (unavailable web apps, slow responses)
- Application dependencies (like DB connections) failing
Utilize monitoring like Event viewer, logs, alerts
**Application logs**- constant auditing of this/automation of alerts. 
Look for these logs: 
- Authentication failures (brute-force attempts, login from unusual IPs or geo-locations)
- Privilege escalation within the application
- Unusual API calls or request patterns (e.g., mass downloads, account enumeration)
- Unexpected or unknown user-agent strings
- Code injections in input fields (SQLi, XSS indicators)
- Error messages revealing internal logic (like database errors or stack traces)
- Modifications to application configurations or roles
### 1.2.4
**Other:**
**Social engineering attacks-** 
- Unexpected emails requesting sensitive information or urgent actions
- Spoofed sender addresses or display names (e.g., `ceo@companny.com`)
- Requests to bypass standard procedures, like sending files via personal email
- Unusual tone or language that doesn’t match normal communication patterns
- Voice phishing (vishing) or fake tech support calls
- USB drops or physical attempts to gain access
**Obfuscated links-** 
- Hyperlinks disguised as trusted sources but redirect elsewhere  _(e.g., display text: `www.microsoft.com`, actual link: `bit.ly/hackedportal`)_
- URL shorteners (bit.ly, tinyurl, goo.gl, etc.)
- Hex-encoded, Base64-encoded, or long subdomain chains:
    - `http://xn--example-kc3d.com` (Punycode)  
    - `http://login.microsoft.account.security.alert.abc.xyz.ru`    
- Links embedded in images/buttons instead of plain text
- Redirect chains or use of `@` symbols in URLs (e.g., `http://safesite.com@malicious.com`)
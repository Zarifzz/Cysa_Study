## 1.3 Given a scenario, use appropriate tools or techniques to determine malicious activity.
---
### 1.3.1 Tools
**Packet capture**:
**Wireshark**- know how to use this; Use filters to find what you want. `tcp.port`, `ip.src,` `ip.dst`, `tcp.window_size`, `<any protocol name>`. instead of ip addr you can do subnet. `192.168.0.0/16` subnet

| Operator | Description                                                               |
| -------- | ------------------------------------------------------------------------- |
| ==       | Equal (example: ip.addr == 192.168.1.3)                                   |
| eq       | Equal (example: tcp.port eq 161)                                          |
| contains | Contains a specific value (example: http contains “http://www.stuff.com”) |
| ne       | Not equal (example: ip.src ne 192.168.1.3)                                |
| !=       | Not equal (example: ip.addr != 192.168.1.3)                               |
| &&       | And (example ip.addr==192.168.1.3&&tcp.port;=23)                          |
| or       | Or (example ip.addr==192.168.1.3 or ip.addr ==192.168.1.4)                |
**tcpdump**- use `sudo tcpdump -i <interface card name>` flags `-port 21` <- FTP 
1st is the time stamp, then protocol used, then the source ip to destination ip. 
**Log analysis/correlation**:
**Security information and event management (SIEM)**- Filter logs, whether its though time or certain events to filter for. This will show you the graphs, & list of logs. Logs will tell you what it thinks it doing and which security tool it has been generated from. 
Investigate the suspicous logs. for example, look at the binaries and see if its a executable, if the first two hexadecimal is `MZ` 
**Security orchestration, automation, and response (SOAR)**- automate some of the routine tasks ordinarily performed by security personnel. 
Scan security and threat intelligence data collected from multiple sources within the enterprise and then analyze it using various techniques. This includes CI & CD, Continuous Integration and Continuous Delivery and Deployment. Basically Orchestrates threat intelligence data and use that to make playbooks/ runbooks to automatically respond to security events. 
Automation in SOC centers
**Endpoint security**:
**Endpoint detection and response (EDR)**- monitor EDR logs, agents, etc. extenstion of EDR: XDR which goes beyond endpoints 
**Domain name service (DNS) and Internet Protocol (IP) reputation**: 
**WHOIS**- check who registered a IP/Domain name. info on domain name and IP addresses. See an ipaddress look who owns it or vise-versa. 
`nslookup` does the same but CLI tool 
**AbuseIPDB**- Check if a IP has a bad reputation  
**File analysis**:
**Strings**- `strings` command used to look whetehr a .exe file has certain suspicous strings like:
```
http://evilsite.com/c2
cmd.exe /c powershell -EncodedCommand ...
RegAdd HKCU\Software\Microsoft\Windows\CurrentVersion\Run
```
Use YARA Rules to Identify malicious string in files
For YARA rule file check the Conditions Boolean statement
**VirusTotal**-  scans files, URLs, and domains using AV engines. Gives you how many different AVs see it a malicious, behavior analysis (what it does), Community submissions 
**Sandboxing**: for dynamic analysis of malware. 
BOTH MADE FOR MALWARE ANALYSIS
**Joe Sandbox**- Windows, Android, macOS, Linux. 
Detects evasion techniques (e.g., sandbox-aware malware)
Provides behavioral graphs, IOC extraction, YARA rule matches
Integrates with SIEM, Threat Intel feeds, and VirusTotal
**Cuckoo Sandbox**- Primarily for Windows malware
Runs files and records API calls, network traffic, file system changes
Generates detailed HTML/JSON reports
Can be integrated with tools like MISP or ELK siems

### 1.3.2 Common Techniques
**Suspicious Commands**

| Command                                | Why It’s Suspicious                               |
| -------------------------------------- | ------------------------------------------------- |
| `powershell -EncodedCommand`           | Common in malware delivery or lateral movement    |
| `whoami` / `net user`                  | Reconnaissance                                    |
| `netstat -an`                          | Checking open connections (used by attackers too) |
| `cmd.exe /c bitsadmin ...`             | Used to download payloads/ data exfiltration      |
| `curl`, `wget`, or `Invoke-WebRequest` | Downloading malware                               |
| `reg add` / `schtasks`                 | Persistence mechanisms                            |
| `vssadmin delete shadows`              | Ransomware behavior (disables recovery)           |
**Email Analysis**
Email headers are:
    - Code at the beginning of an email that contains such things as:
        - Recipient's name.
        - Send date.
        - Timestamps.
        - Names of servers that handled the transfer.
    - Typically hidden from the reader's view at the top of the page.
Block signatures:
    - Contain helpful information about the sender, such as:
        - Name.
        - Company position.
        - Address.
        - Phone number.
    - Are often automatically included at the end of an email.

| Authentication Tool                                                          | Description                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ---------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| DomainKeys Identified Mail  <br>(DKIM)                                       | You can use DKIM to authenticate emails to mitigate potential harm.<br><br>Digitally signs Emails and YOUR email server checks whether the digital signature is valid or not                                                                                                                                                                                                                                                      |
| Sender Policy Framework  <br>(SPF)                                           | SPF is a tool designed to stop attackers who send spam emails under someone else's name. It allows the sender to specify email servers that can send an email in the domain and which servers are not allowed to send emails.                                                                                                                                                                                                     |
| Domain-based Message Authentication, Reporting, and Conformance  <br>(DMARC) | DMARC is an email authentication policy and reporting protocol.<br><br>- It builds on DKIM and SPF security.<br>- REPORTING: The recipient is informed by the sender that the emails being sent are protected by DKIM and SPF.<br>- CONFORMANCE:  It includes instructions within its record that direct what happens if an email does not pass the safety checks <br>- AUTHENTICATION: Uses Dkim and Spf to authenticate emails. |
Be able to read and understand raw email headers and block signatures
### 1.3.3 Programming languages/scripting
Linux dir commands like cat, ls, cd, mv, locate, find, etc. 

vi/vim- A file editor for use in a terminal. Very popular but nonintuitive to use.
su- Substitute or switch user.
sudo- Precedes a command that requires elevated privileges.
useradd- Create a user account.
usermod- Change the attributes of a user account.
chmod- Change the read, write, and execute attributes of a file or directory.
chown- Change permissions on a file or directory.
mkfifo- Similar in concept to a standard | style pipe but implemented as an actual file

JSON- used for JavaScript apps and easy to use. 
XML- used more for schema based apps and better data structure organization 

Windows Management Instrumentation Command Line (WMIC)- CLI for interacting with WMI, used in batch, CMD, etc scripts. 
`wmic [<alias>] [where <condition>] [get <properties> | call <method>]`
- `alias`: WMI class shortcut (e.g., `process`, `os`, `useraccount`)
- `where`: Optional condition to filter results
- `get`: Retrieves properties
- `call`: Executes a method
Regex:

| Element | Purpose              |
| ------- | -------------------- |
| [ABC]   | Character set        |
| [A-Z]   | Range                |
| \w      | Word                 |
| \d      | Digit                |
| \s      | Whitespace           |
| ^       | Beginning            |
| $       | End                  |
| ?       | May or may not exist |
| {1,3}   | Quantifier           |
